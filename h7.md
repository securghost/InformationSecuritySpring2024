# [h7. Free Tickets](https://terokarvinen.com/2024/information-security-2024-spring/#h7-free-tickets)

## x) Free tickets. View and summarize a hacker or security conference presentation. It should be a full length (>30 min) presentation. Brief summary with some bullets is enough.

[[Disobey 2023] Finding vulnerabilities in offensive security tooling - Jonas Vestberg](https://www.youtube.com/watch?v=XGSWNXa4XmU)

**This talk:**

**Scenario:**

  **Attacker** - unprivileged attacker with foothold in the environment
  **User** - pentesters using offensive security tooling agains a target
  **Victim** - the systems targeted by pentesters (and attackers)

**Impacket** example scripts
 - kind of lame (just examples)
 - good enough
 - still used by pentesters (and real attackers)
 - ported to other languages / frameworks

**Disclaimer**

   "The example scripts in impacket are just that, example scripts and are     not meant to be used in a procuction system."

- PR in Github are incoming (no CVEs)
- His code is released once PR are done.
- This talk is not about avoiding detection!

**Impacket**

"Impacket is a collection of Phython classes for working with network protocols."

SMB, MS-RPC, etc
Hacking Windows from Linux
Use with password/ticket/hash

Example scripts:
- secretsdump.py
- smbexec.py
- psexec.py


**secretsdump.py**

"Performs various techniques to dump hashes from the remote machine without executing any agent there". 

- Post-exploitation
- Dump registry secrets remotely

  The dumped secrets

- Service credentials in clear text
- Password hashed of local users (crack or pass the hash)
- Password of computer account (if domain joined)
- Cached credentials of interactive logins (crack)

$ impacket-secretsdump domain/adminuser@target

1. Enable remote registry
2. Get boot key (deobfuscate data in SYSTEM hive)
3. Save SAM hive to C:\Windows\System32\[random].tmp
4. Extract local hashes from \\target\admin$\System32\[random].tmp
5. Save SECURITY hive to C:\Windows\System32\[random].tmp
6. Extract LSA secrets from \\target\admin$\System32\[random].tmp
7. Remove temporary files and disable remote registry

**Demo**

- Unprivileged attacker on the target.
- Pentester use secretdump.py agains the target

![image](https://github.com/securghost/InformationSecuritySpring2024/assets/142783540/a4cfdc7d-f439-4fcd-aa09-5da29266d9e8)

![image](https://github.com/securghost/InformationSecuritySpring2024/assets/142783540/9fa83f75-91a8-4544-a439-e3431abc81c4)

**local privesc**

1. Wait for [random].tmp files in C:\Windows\System32
2. Copy [random].tmp files in C:\Windows\System32
3. Get boot key
4. Dump local hashes and LSA secrets
5. Pass the hash of local admin or create a silver ticket with computer account (if domain joined)

Same code used in or ported to:
- CrackMapExec
- Metasploit (auxiliary/gather/windows_secrets_dump)
- ?

![image](https://github.com/securghost/InformationSecuritySpring2024/assets/142783540/5e51404c-1a61-43e6-ae9c-09bf233058a5)

Intrestingly, the documentation in the script said that it was suppose to be saving it into temp file, however, Jonas could not verified it. 

This is the SharpSecDump:

![image](https://github.com/securghost/InformationSecuritySpring2024/assets/142783540/f118a021-eeb5-4523-9230-bbb253ad3a5e)







## a) Voluntary: Feed me. Set up RSS feed reader and follow some security related feeds.










## Sources:
1. Tero Karvinen. InformationSecuritySpring2024 h7. URL: https://terokarvinen.com/2024/information-security-2024-spring/#h7-free-tickets. Accessed: 5.3.2024.
2. [Disobey 2023] Finding vulnerabilities in offensive security tooling - Jonas Vestberg. URL: https://www.youtube.com/watch?v=XGSWNXa4XmU. Watched: 5.3.2024.
